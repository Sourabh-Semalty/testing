"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const toMb = (num) => Math.round(num / (1024 * 1024));
function scheduleGC() {
    if (global.gc) {
        const tmr = setInterval(() => {
            const beforeGC = process.memoryUsage().rss;
            global.gc();
            const afterGC = process.memoryUsage().rss;
            const diff = Math.abs(beforeGC - afterGC);
            const diffPercent = (diff * 100) / beforeGC;
            if (diffPercent > 10) {
                console.log(`mem.usage ${toMb(beforeGC)}Mb -> ${toMb(afterGC)}Mb`);
            }
        }, 1000 * 3 * 60);
        process.once('SIGTERM', () => clearInterval(tmr));
    }
    else {
        console.log(`gc.disabled`);
    }
}
exports.scheduleGC = scheduleGC;
